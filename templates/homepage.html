{% extends 'base.html' %}
{% block title %}Occasion Reminders{% endblock %}

{% block body %}

<a href="/sync-events">Sync your reminders to your calendar</a><br><br>

<b>Add tiers:</b> <br>
<form id="new-tier" method="post"> <!-- ajax...?-->
  Name:<input type="text" id="tier-name" name="tier-name"><br> <!-- help text, required fields, data validation / sanitizing -->
  Description:<input type="text" id="tier-desc" name="tier-desc"><br>
  Reminder timeline (days ahead):<input type="number" id="tier-days-ahead" name="tier-days-ahead" min="0" max="100" step="1"><br>
  Reminder Type:
    <input type="radio" value="popup" id="tier-reminder-type" name="tier-reminder-type">
    <label for="popup">popup</label>
    <input type="radio" value="email" id="tier-reminder-type" name="tier-reminder-type">
    <label for="email">email</label><br>
  <input type="submit">
</form>
<br>
<br>
{% if not tiers %}
  You haven't added any notification tiers yet! 
{% endif %} 
<table>
    {% if tiers %}
    <tr>
      <th>Notification Tier Name</th>
      <th>Description</th>
      <th>Reminder timeline (days ahead)</th>
      <th>Reminder type</th>
    </tr>
    {% endif %}
    {% for tier in tiers %}
    <tr>
      <td>{{ tier.name }}</td>
      <td>{{ tier.description }}</td>
      <td>{{ tier.reminder_days_ahead }}</td>
      <td>{{ tier.reminder_type }}</td>
    </tr>
    {% endfor %}
</table>
<br>
<b>Update contacts:</b><br>
{% if has_imported %}
<!--- room for improvement (incremental load?)-->
You've already imported your contacts! Your Google contacts should remain your 
source of truth, so if you'd like to reimport to update with any changes made there, 
you can refresh below: 
<a href="/clear-contacts">Refresh contacts</a><br> 
{% else %}
<a href="/import-contacts">Import contacts</a><br> 
{% endif %}
<br>
<table>
    <tr>
      <th>First Name</th>
      <th>Last Name</th>
      <th>Occasion Type</th>
      <th>Occasion Date</th>
      <th>Notification Tier</th>
    </tr>
    {% for occasion in occasions %}
    <tr>
      <td>{{ occasion.contact.fname }}</td>
      <td>{{ occasion.contact.lname }}</td>
      <td>{{ occasion.occasion_type }}</td>
      <td>{{ occasion.date }}</td>
      <td><span class=tier_name_{{ occasion.occasion_id }}>{{ occasion.tier.name }}</span></td>
      <td><button type="button" id="{{ occasion.occasion_id }}" class="upd-tier">Update tier</button></td>
    </tr>
    {% endfor %}
</table>
<script src = "/static/associate-tiers.js"></script>
<script src="/static/tiers.js"> </script> 
{% endblock %}